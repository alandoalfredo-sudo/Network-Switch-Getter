<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Switch Dashboard - Network Switch Getter</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .switch-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        
        .switch-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .switch-header {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            position: relative;
        }
        
        .switch-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }
        
        .switch-status {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-online { background-color: #28a745; }
        .status-offline { background-color: #dc3545; }
        .status-unknown { background-color: #ffc107; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .port-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .port {
            aspect-ratio: 1;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: white;
        }
        
        .port:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 10;
        }
        
        .port-number {
            font-weight: 600;
            font-size: 0.9rem;
            color: #495057;
        }
        
        .port-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-top: 4px;
        }
        
        .port-up { background-color: #28a745; }
        .port-down { background-color: #dc3545; }
        .port-error { background-color: #ffc107; }
        .port-unknown { background-color: #6c757d; }
        
        .port-info {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }
        
        .port:hover .port-info {
            opacity: 1;
        }
        
        .port-info::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #2c3e50;
        }
        
        .switch-tabs {
            background: #e9ecef;
            border-bottom: 1px solid #dee2e6;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: #495057;
            font-weight: 500;
        }
        
        .nav-tabs .nav-link.active {
            background: white;
            color: #2c3e50;
            border-bottom: 3px solid #007bff;
        }
        
        .port-config-modal .modal-dialog {
            max-width: 800px;
        }
        
        .config-section {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .config-section h6 {
            color: #495057;
            font-weight: 600;
            margin-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 5px;
        }
        
        .live-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #28a745;
            border-radius: 50%;
            animation: pulse 2s infinite;
            margin-right: 5px;
        }
        
        .switch-stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #007bff;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #6c757d;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <div class="switch-container">
        <div class="container-fluid">
            <!-- Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h1 class="text-white mb-0">
                                <i class="fas fa-network-wired me-3"></i>Switch Dashboard
                            </h1>
                            <p class="text-white-50 mb-0">Real-time port monitoring and configuration</p>
                        </div>
                        <div class="d-flex align-items-center gap-3">
                            <span class="live-indicator"></span>
                            <span class="text-white">Live Updates</span>
                            <button class="btn btn-light" onclick="refreshData()">
                                <i class="fas fa-sync-alt me-1"></i>Refresh
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Switch Tabs -->
            <div class="row">
                <div class="col-12">
                    <div class="switch-card">
                        <div class="switch-tabs">
                            <ul class="nav nav-tabs" id="switchTabs" role="tablist">
                                <!-- Switch tabs will be populated here -->
                            </ul>
                        </div>
                        
                        <div class="tab-content" id="switchTabContent">
                            <!-- Switch content will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Port Configuration Modal -->
    <div class="modal fade" id="portConfigModal" tabindex="-1">
        <div class="modal-dialog port-config-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-cog me-2"></i>Port Configuration
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="portConfigForm">
                        <input type="hidden" id="configSwitchId">
                        <input type="hidden" id="configPortNumber">
                        
                        <!-- Basic Settings -->
                        <div class="config-section">
                            <h6><i class="fas fa-info-circle me-2"></i>Basic Settings</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">Port Name/Alias</label>
                                    <input type="text" class="form-control" id="portName" placeholder="e.g., Server-01">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Description</label>
                                    <input type="text" class="form-control" id="portDescription" placeholder="Port description">
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <label class="form-label">Admin Status</label>
                                    <select class="form-select" id="adminStatus">
                                        <option value="up">Enable</option>
                                        <option value="down">Disable</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Port Mode</label>
                                    <select class="form-select" id="portMode">
                                        <option value="access">Access</option>
                                        <option value="trunk">Trunk</option>
                                        <option value="hybrid">Hybrid</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Speed and Duplex -->
                        <div class="config-section">
                            <h6><i class="fas fa-tachometer-alt me-2"></i>Speed & Duplex</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">Speed</label>
                                    <select class="form-select" id="portSpeed">
                                        <option value="auto">Auto</option>
                                        <option value="10">10 Mbps</option>
                                        <option value="100">100 Mbps</option>
                                        <option value="1000">1000 Mbps</option>
                                        <option value="10000">10 Gbps</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Duplex</label>
                                    <select class="form-select" id="portDuplex">
                                        <option value="auto">Auto</option>
                                        <option value="half">Half</option>
                                        <option value="full">Full</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- VLAN Configuration -->
                        <div class="config-section">
                            <h6><i class="fas fa-sitemap me-2"></i>VLAN Configuration</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">Access VLAN</label>
                                    <input type="number" class="form-control" id="accessVlan" placeholder="1-4094" min="1" max="4094">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Native VLAN (Trunk)</label>
                                    <input type="number" class="form-control" id="nativeVlan" placeholder="1-4094" min="1" max="4094">
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-12">
                                    <label class="form-label">Allowed VLANs (Trunk)</label>
                                    <input type="text" class="form-control" id="allowedVlans" placeholder="1-10,20,30 or all">
                                </div>
                            </div>
                        </div>

                        <!-- Advanced Settings -->
                        <div class="config-section">
                            <h6><i class="fas fa-cogs me-2"></i>Advanced Settings</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="poeEnabled">
                                        <label class="form-check-label" for="poeEnabled">
                                            PoE Enabled
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="stpEnabled">
                                        <label class="form-check-label" for="stpEnabled">
                                            STP Enabled
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="portSecurityEnabled">
                                        <label class="form-check-label" for="portSecurityEnabled">
                                            Port Security
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="stormControlEnabled">
                                        <label class="form-check-label" for="stormControlEnabled">
                                            Storm Control
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3" id="portSecuritySettings" style="display: none;">
                                <div class="col-md-6">
                                    <label class="form-label">Max MAC Addresses</label>
                                    <input type="number" class="form-control" id="maxMacAddresses" placeholder="1-10" min="1" max="10">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Violation Action</label>
                                    <select class="form-select" id="violationAction">
                                        <option value="shutdown">Shutdown</option>
                                        <option value="restrict">Restrict</option>
                                        <option value="protect">Protect</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Link Aggregation -->
                        <div class="config-section">
                            <h6><i class="fas fa-link me-2"></i>Link Aggregation</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label">LAG Group</label>
                                    <select class="form-select" id="lagGroup">
                                        <option value="none">None</option>
                                        <option value="1">LAG 1</option>
                                        <option value="2">LAG 2</option>
                                        <option value="3">LAG 3</option>
                                        <option value="4">LAG 4</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">LACP Mode</label>
                                    <select class="form-select" id="lacpMode">
                                        <option value="off">Off</option>
                                        <option value="active">Active</option>
                                        <option value="passive">Passive</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-warning" onclick="revertToDefaults()">Revert to Defaults</button>
                    <button type="button" class="btn btn-primary" onclick="applyPortConfig()">
                        <i class="fas fa-save me-1"></i>Apply Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let switches = [];
        let currentSwitch = null;
        let refreshInterval;
        let websocket = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadSwitches();
            setupEventListeners();
            connectWebSocket();
        });

        function setupEventListeners() {
            // Port security toggle
            document.getElementById('portSecurityEnabled').addEventListener('change', function() {
                const settings = document.getElementById('portSecuritySettings');
                settings.style.display = this.checked ? 'block' : 'none';
            });
        }

        async function loadSwitches() {
            try {
                const response = await fetch('/api/switches');
                switches = await response.json();
                renderSwitchTabs();
                if (switches.length > 0) {
                    showSwitch(switches[0].ip);
                }
            } catch (error) {
                console.error('Error loading switches:', error);
            }
        }

        function renderSwitchTabs() {
            const tabsContainer = document.getElementById('switchTabs');
            const contentContainer = document.getElementById('switchTabContent');
            
            tabsContainer.innerHTML = '';
            contentContainer.innerHTML = '';

            switches.forEach((switchDevice, index) => {
                // Create tab
                const tabId = `switch-${switchDevice.ip.replace(/\./g, '-')}`;
                const tab = document.createElement('li');
                tab.className = 'nav-item';
                tab.innerHTML = `
                    <button class="nav-link ${index === 0 ? 'active' : ''}" 
                            id="${tabId}-tab" 
                            data-bs-toggle="tab" 
                            data-bs-target="#${tabId}" 
                            type="button" 
                            role="tab">
                        <i class="fas fa-network-wired me-2"></i>${switchDevice.name || `Switch ${switchDevice.ip}`}
                    </button>
                `;
                tabsContainer.appendChild(tab);

                // Create tab content
                const tabContent = document.createElement('div');
                tabContent.className = `tab-pane fade ${index === 0 ? 'show active' : ''}`;
                tabContent.id = tabId;
                tabContent.innerHTML = renderSwitchContent(switchDevice);
                contentContainer.appendChild(tabContent);
            });
        }

        function renderSwitchContent(switchDevice) {
            return `
                <div class="switch-header">
                    <h3 class="switch-title">${switchDevice.name || `Switch ${switchDevice.ip}`}</h3>
                    <div class="switch-status">
                        <span class="status-indicator status-online"></span>
                        <span>Online</span>
                    </div>
                    <div class="switch-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="totalPorts-${switchDevice.ip}">24</div>
                            <div class="stat-label">Total Ports</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="activePorts-${switchDevice.ip}">0</div>
                            <div class="stat-label">Active</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="downPorts-${switchDevice.ip}">0</div>
                            <div class="stat-label">Down</div>
                        </div>
                    </div>
                </div>
                <div class="port-grid" id="portGrid-${switchDevice.ip}">
                    ${renderPortGrid(switchDevice)}
                </div>
            `;
        }

        function renderPortGrid(switchDevice) {
            let html = '';
            for (let i = 1; i <= 24; i++) {
                const portData = getPortData(switchDevice.ip, i);
                html += `
                    <div class="port port-${portData.status}" 
                         data-switch="${switchDevice.ip}" 
                         data-port="${i}"
                         onclick="openPortConfig('${switchDevice.ip}', ${i})"
                         onmouseenter="showPortInfo(event, '${switchDevice.ip}', ${i})">
                        <div class="port-number">${i}</div>
                        <div class="port-status port-${portData.status}"></div>
                        <div class="port-info">
                            <div><strong>Port ${i}</strong></div>
                            <div>MAC: ${portData.macAddress || 'N/A'}</div>
                            <div>IP: ${portData.ipAddress || 'N/A'}</div>
                            <div>VLAN: ${portData.vlan || 'N/A'}</div>
                            <div>Speed: ${portData.speed || 'Unknown'}</div>
                        </div>
                    </div>
                `;
            }
            return html;
        }

        function getPortData(switchIp, portNumber) {
            // Simulate port data - in real implementation, this would come from the API
            const statuses = ['up', 'down', 'error', 'unknown'];
            const speeds = ['1 Gbps', '100 Mbps', '10 Gbps', 'Unknown'];
            const vlans = [1, 10, 20, 30, 100, null];
            
            return {
                status: statuses[Math.floor(Math.random() * statuses.length)],
                macAddress: generateRandomMAC(),
                ipAddress: Math.random() > 0.3 ? generateRandomIP() : null,
                vlan: vlans[Math.floor(Math.random() * vlans.length)],
                speed: speeds[Math.floor(Math.random() * speeds.length)]
            };
        }

        function generateRandomMAC() {
            return Array.from({length: 6}, () => Math.floor(Math.random() * 256).toString(16).padStart(2, '0')).join(':');
        }

        function generateRandomIP() {
            const ranges = ['192.168.1.', '192.168.0.', '10.0.0.', '172.16.0.'];
            const base = ranges[Math.floor(Math.random() * ranges.length)];
            return base + Math.floor(Math.random() * 254 + 1);
        }

        function showPortInfo(event, switchIp, portNumber) {
            // Port info is shown via CSS hover
        }

        function openPortConfig(switchIp, portNumber) {
            currentSwitch = switchIp;
            const portData = getPortData(switchIp, portNumber);
            
            // Populate modal with current port data
            document.getElementById('configSwitchId').value = switchIp;
            document.getElementById('configPortNumber').value = portNumber;
            document.getElementById('portName').value = `Port-${portNumber}`;
            document.getElementById('portDescription').value = `Port ${portNumber} configuration`;
            document.getElementById('adminStatus').value = portData.status === 'up' ? 'up' : 'down';
            document.getElementById('portSpeed').value = 'auto';
            document.getElementById('portDuplex').value = 'auto';
            document.getElementById('accessVlan').value = portData.vlan || '';
            document.getElementById('nativeVlan').value = '1';
            document.getElementById('allowedVlans').value = 'all';
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('portConfigModal'));
            modal.show();
        }

        function applyPortConfig() {
            const formData = {
                switchId: document.getElementById('configSwitchId').value,
                portNumber: document.getElementById('configPortNumber').value,
                portName: document.getElementById('portName').value,
                description: document.getElementById('portDescription').value,
                adminStatus: document.getElementById('adminStatus').value,
                portMode: document.getElementById('portMode').value,
                speed: document.getElementById('portSpeed').value,
                duplex: document.getElementById('portDuplex').value,
                accessVlan: document.getElementById('accessVlan').value,
                nativeVlan: document.getElementById('nativeVlan').value,
                allowedVlans: document.getElementById('allowedVlans').value,
                poeEnabled: document.getElementById('poeEnabled').checked,
                stpEnabled: document.getElementById('stpEnabled').checked,
                portSecurityEnabled: document.getElementById('portSecurityEnabled').checked,
                stormControlEnabled: document.getElementById('stormControlEnabled').checked,
                maxMacAddresses: document.getElementById('maxMacAddresses').value,
                violationAction: document.getElementById('violationAction').value,
                lagGroup: document.getElementById('lagGroup').value,
                lacpMode: document.getElementById('lacpMode').value
            };

            // Send configuration to backend
            fetch('/api/port-config', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Port configuration applied successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('portConfigModal')).hide();
                    refreshData();
                } else {
                    alert('Error applying configuration: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error applying configuration');
            });
        }

        function revertToDefaults() {
            if (confirm('Are you sure you want to revert to default settings?')) {
                // Reset form to defaults
                document.getElementById('portName').value = '';
                document.getElementById('portDescription').value = '';
                document.getElementById('adminStatus').value = 'up';
                document.getElementById('portMode').value = 'access';
                document.getElementById('portSpeed').value = 'auto';
                document.getElementById('portDuplex').value = 'auto';
                document.getElementById('accessVlan').value = '1';
                document.getElementById('nativeVlan').value = '1';
                document.getElementById('allowedVlans').value = 'all';
                document.getElementById('poeEnabled').checked = false;
                document.getElementById('stpEnabled').checked = true;
                document.getElementById('portSecurityEnabled').checked = false;
                document.getElementById('stormControlEnabled').checked = false;
                document.getElementById('maxMacAddresses').value = '';
                document.getElementById('violationAction').value = 'shutdown';
                document.getElementById('lagGroup').value = 'none';
                document.getElementById('lacpMode').value = 'off';
            }
        }

        function refreshData() {
            loadSwitches();
        }

        function connectWebSocket() {
            try {
                websocket = new WebSocket('ws://localhost:8765');
                
                websocket.onopen = function(event) {
                    console.log('WebSocket connected');
                };
                
                websocket.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    handleWebSocketMessage(data);
                };
                
                websocket.onclose = function(event) {
                    console.log('WebSocket disconnected, attempting to reconnect...');
                    setTimeout(connectWebSocket, 5000);
                };
                
                websocket.onerror = function(error) {
                    console.error('WebSocket error:', error);
                };
            } catch (error) {
                console.error('Failed to connect to WebSocket:', error);
                // Fallback to polling
                startLiveUpdates();
            }
        }

        function handleWebSocketMessage(data) {
            switch (data.type) {
                case 'initial_data':
                    switches = data.switches;
                    renderSwitchTabs();
                    if (switches.length > 0) {
                        showSwitch(switches[0].ip);
                    }
                    break;
                
                case 'port_update':
                    updatePorts(data.updates);
                    break;
                
                case 'port_status':
                    updateSinglePort(data.switch_ip, data.port_number, data.data);
                    break;
                
                case 'switch_ports':
                    updateSwitchPorts(data);
                    break;
            }
        }

        function updatePorts(updates) {
            updates.forEach(update => {
                update.ports.forEach(portData => {
                    updateSinglePort(update.switch_ip, portData.port_number, portData);
                });
            });
        }

        function updateSinglePort(switchIp, portNumber, portData) {
            const portElement = document.querySelector(`[data-switch="${switchIp}"][data-port="${portNumber}"]`);
            if (portElement) {
                // Update port status
                portElement.className = `port port-${portData.status}`;
                
                // Update port info
                const portInfo = portElement.querySelector('.port-info');
                if (portInfo) {
                    portInfo.innerHTML = `
                        <div><strong>Port ${portNumber}</strong></div>
                        <div>MAC: ${portData.mac_address || 'N/A'}</div>
                        <div>IP: ${portData.ip_address || 'N/A'}</div>
                        <div>VLAN: ${portData.vlan || 'N/A'}</div>
                        <div>Speed: ${portData.speed || 'Unknown'}</div>
                    `;
                }
                
                // Update statistics
                updateSwitchStats(switchIp);
            }
        }

        function updateSwitchStats(switchIp) {
            const portElements = document.querySelectorAll(`[data-switch="${switchIp}"]`);
            let totalPorts = 0;
            let activePorts = 0;
            let downPorts = 0;
            
            portElements.forEach(port => {
                totalPorts++;
                if (port.classList.contains('port-up')) {
                    activePorts++;
                } else if (port.classList.contains('port-down')) {
                    downPorts++;
                }
            });
            
            // Update statistics display
            const totalElement = document.getElementById(`totalPorts-${switchIp}`);
            const activeElement = document.getElementById(`activePorts-${switchIp}`);
            const downElement = document.getElementById(`downPorts-${switchIp}`);
            
            if (totalElement) totalElement.textContent = totalPorts;
            if (activeElement) activeElement.textContent = activePorts;
            if (downElement) downElement.textContent = downPorts;
        }

        function startLiveUpdates() {
            refreshInterval = setInterval(refreshData, 5000); // Update every 5 seconds
        }

        function stopLiveUpdates() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (websocket) {
                websocket.close();
            }
            stopLiveUpdates();
        });
    </script>
</body>
</html>
